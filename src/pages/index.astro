---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import '../styles/global.css';

// Fetch all content from both collections
const articles = await getCollection('articles');
const episodes = await getCollection('episodes');

// Build a unified list of cards with a consistent shape
const shadowColors = ['black', '#006AB4', 'black', '#E31C25', 'black', '#006AB4'];
let colorIdx = 0;

const allCards = [
  ...articles.map((entry) => ({
    type: 'article' as const,
    contentType: entry.data.contentType || 'Case Study',
    title: entry.data.title.replace(/<[^>]*>/g, ''),           // strip HTML spans for card
    subtitle: entry.data.subtitle || '',
    slug: entry.data.urlSlug,
    tags: entry.data.tags || [],
    takeaway: entry.data.takeaways?.[0]?.text || '',
    seriesTag: entry.data.contentType || 'Case Study',
    heroImage: entry.data.heroImage || '',
  })),
  ...episodes.map((entry) => ({
    type: 'episode' as const,
    contentType: 'Podcast',
    title: entry.data.title.replace(/<[^>]*>/g, ''),
    subtitle: entry.data.subtitle || '',
    slug: entry.data.urlSlug,
    tags: entry.data.tags || [],
    takeaway: entry.data.takeaways?.[0]?.text || '',
    seriesTag: entry.data.seriesTag || 'Episode',
    heroImage: entry.data.heroImage || '',
  })),
];

// Badge color map
const badgeColors: Record<string, { bg: string; text: string }> = {
  'Podcast':    { bg: '#E31C25', text: 'white' },
  'Case Study': { bg: '#006AB4', text: 'white' },
  'Article':    { bg: '#006AB4', text: 'white' },
  'Playbook':   { bg: '#FFC906', text: 'black' },
  'Research':   { bg: '#FFC906', text: 'black' },
  'Book':       { bg: '#FFC906', text: 'black' },
  'Video':      { bg: '#006AB4', text: 'white' },
};
---

<BaseLayout title="Knowledge Hub">

    <!-- ===== HERO SECTION ===== -->
    <header class="pt-28 pb-0 px-4 max-w-7xl mx-auto">
        <div class="bg-[#1a1a1a] border-4 border-black p-8 md:p-14 relative overflow-hidden">
            <!-- Decorative elements -->
            <div class="absolute top-0 right-0 w-48 h-48 bg-[#E31C25] opacity-10 rotate-45 translate-x-16 -translate-y-16"></div>
            <div class="absolute bottom-0 left-0 w-32 h-32 bg-[#FFC906] opacity-10 -translate-x-8 translate-y-8"></div>

            <div class="relative z-10">
                <span class="bg-[#E31C25] text-white px-4 py-1 text-xs font-black uppercase tracking-[0.2em] border-2 border-white/20 inline-block mb-6">By Practitioners, For Practitioners</span>
                <h1 class="text-5xl md:text-7xl lg:text-8xl brand-font text-white uppercase leading-[0.9] mb-6">
                    ACME<br>Knowledge<br><span class="text-[#FFC906]">Hub</span>
                </h1>
                <p class="text-lg md:text-xl slab-text text-gray-300 max-w-2xl leading-relaxed mb-8">
                    High-signal takeaways from podcasts, YouTube, and books — filtered through practitioner reality. <span class="text-[#FFC906] font-bold">No summaries. Only what actually changes how you work.</span>
                </p>
                <div class="flex flex-wrap gap-4">
                    <a href="#content" class="bg-[#FFC906] text-black border-2 border-[#FFC906] font-black py-3 px-8 uppercase text-sm tracking-widest hover:bg-white hover:border-white transition-colors inline-flex items-center gap-2">
                        Explore Knowledge <i class="ph-bold ph-arrow-down"></i>
                    </a>
                    <a href="#subscribe" class="bg-transparent text-white border-2 border-white font-black py-3 px-8 uppercase text-sm tracking-widest hover:bg-white hover:text-black transition-colors inline-flex items-center gap-2">
                        Subscribe for Weekly Drops <i class="ph-bold ph-envelope-simple"></i>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- ===== DISCOVERY CONTROLS ===== -->
    <section id="content" class="pt-12 pb-4 px-4 max-w-7xl mx-auto">
        <!-- Search Bar -->
        <div class="mb-8">
            <div class="relative">
                <i class="ph-bold ph-magnifying-glass absolute left-5 top-1/2 -translate-y-1/2 text-xl text-gray-400"></i>
                <input type="text" placeholder="Search by topic, creator, or idea..." class="search-input w-full bg-white border-4 border-black pl-14 pr-6 py-4 font-bold text-lg placeholder:text-gray-400 placeholder:font-medium">
            </div>
        </div>

        <!-- Filter: Format -->
        <div class="mb-4">
            <span class="font-black text-xs uppercase tracking-widest text-gray-500 mr-4">Format:</span>
            <div class="inline-flex flex-wrap gap-2">
                <button class="filter-btn active border-2 border-black px-4 py-1.5 font-bold uppercase text-[10px] transition-all tracking-wider">All</button>
                <button class="filter-btn border-2 border-black px-4 py-1.5 font-bold uppercase text-[10px] bg-white hover:bg-gray-100 transition-all tracking-wider inline-flex items-center gap-1">
                    <i class="ph-fill ph-microphone-stage text-[#E31C25]"></i> Podcast
                </button>
                <button class="filter-btn border-2 border-black px-4 py-1.5 font-bold uppercase text-[10px] bg-white hover:bg-gray-100 transition-all tracking-wider inline-flex items-center gap-1">
                    <i class="ph-fill ph-article text-[#006AB4]"></i> Case Study
                </button>
                <button class="filter-btn border-2 border-black px-4 py-1.5 font-bold uppercase text-[10px] bg-white hover:bg-gray-100 transition-all tracking-wider inline-flex items-center gap-1">
                    <i class="ph-fill ph-book-open text-[#FFC906]"></i> Book
                </button>
            </div>
        </div>

        <!-- Filter: Theme -->
        <div class="mb-4">
            <span class="font-black text-xs uppercase tracking-widest text-gray-500 mr-4">Theme:</span>
            <div class="inline-flex flex-wrap gap-2">
                <button class="theme-btn border-2 border-black px-4 py-1.5 font-bold uppercase text-[10px] bg-white hover:bg-gray-100 transition-all tracking-wider">Strategy</button>
                <button class="theme-btn border-2 border-black px-4 py-1.5 font-bold uppercase text-[10px] bg-white hover:bg-gray-100 transition-all tracking-wider">GTM</button>
                <button class="theme-btn border-2 border-black px-4 py-1.5 font-bold uppercase text-[10px] bg-white hover:bg-gray-100 transition-all tracking-wider">Brand</button>
                <button class="theme-btn border-2 border-black px-4 py-1.5 font-bold uppercase text-[10px] bg-white hover:bg-gray-100 transition-all tracking-wider">ABM</button>
                <button class="theme-btn border-2 border-black px-4 py-1.5 font-bold uppercase text-[10px] bg-white hover:bg-gray-100 transition-all tracking-wider">AI</button>
                <button class="theme-btn border-2 border-black px-4 py-1.5 font-bold uppercase text-[10px] bg-white hover:bg-gray-100 transition-all tracking-wider">Content</button>
                <button class="theme-btn border-2 border-black px-4 py-1.5 font-bold uppercase text-[10px] bg-white hover:bg-gray-100 transition-all tracking-wider">Growth</button>
            </div>
        </div>

        <div class="mb-10"></div>
    </section>

    <!-- ===== CONTENT GRID (MASONRY) — dynamically populated from CMS ===== -->
    <section class="pb-16 px-4 max-w-7xl mx-auto">
        <div class="masonry-grid">

            {allCards.map((card, i) => {
                const shadow = shadowColors[i % shadowColors.length];
                const badge = badgeColors[card.contentType] || { bg: 'black', text: 'white' };
                return (
                    <article class="group relative">
                        <div class="absolute inset-0 translate-x-2 translate-y-2 border-2 border-black" style={`background:${shadow};`}></div>
                        <a href={`/hub/${card.slug}`} class="relative bg-white border-4 border-black flex flex-col hover:translate-y-[-2px] hover:translate-x-[-2px] transition-all block h-full">
                            {card.heroImage && (
                                <div class="w-full border-b-4 border-black overflow-hidden bg-[#1a1a1a]">
                                    <img src={card.heroImage} alt={card.title} class="w-full h-44 object-cover object-left-top" loading="lazy" />
                                </div>
                            )}
                            <div class="p-6 flex flex-col flex-1">
                            <div class="flex justify-between items-start mb-4">
                                <span class="text-xs font-black px-2 py-1 uppercase border-2 border-black" style={`background:${badge.bg};color:${badge.text};`}>{card.contentType}</span>
                                <span class="text-gray-400 group-hover:text-black transition-colors"><i class="ph-bold ph-arrow-up-right text-xl"></i></span>
                            </div>
                            <h3 class="text-2xl brand-font uppercase leading-tight mb-3">{card.title}</h3>
                            <p class="slab-text text-gray-700 mb-6">{card.subtitle}</p>
                            {card.takeaway && (
                                <div class="bg-[#FFC906] p-4 border-2 border-black mb-4">
                                    <span class="block font-black text-xs uppercase mb-2">Key Takeaway:</span>
                                    <p class="font-bold text-sm">{card.takeaway}</p>
                                </div>
                            )}
                            <div class="flex flex-wrap gap-2 mt-auto">
                                {card.tags.map((tag: string) => (
                                    <span class="text-[10px] font-black uppercase border border-black px-2 py-0.5">{tag}</span>
                                ))}
                                <span class="text-[10px] font-black uppercase border border-black px-2 py-0.5 bg-gray-100">{card.seriesTag}</span>
                            </div>
                            </div>
                        </a>
                    </article>
                );
            })}

            {allCards.length === 0 && (
                <div class="col-span-full text-center py-20">
                    <p class="text-2xl brand-font uppercase text-gray-400 mb-4">No content yet</p>
                    <p class="slab-text text-gray-500">Add articles or episodes via the <a href="/admin" class="text-[#E31C25] underline font-bold">CMS admin</a> to see them here.</p>
                </div>
            )}

        </div>
    </section>

    <!-- ===== WHY THIS HUB EXISTS ===== -->
    <section class="py-16 px-4 max-w-7xl mx-auto">
        <div class="bg-white border-4 border-black p-8 md:p-12 brutalist-shadow-static">
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div>
                    <h2 class="text-4xl md:text-5xl brand-font uppercase mb-6 leading-tight">
                        Why This <span class="text-[#E31C25]">Hub</span> Exists
                    </h2>
                    <p class="slab-text text-xl text-gray-700 leading-relaxed mb-6">
                        Because most marketing content tells you what was said. We focus on <span class="font-bold text-black">what actually matters for decision-making.</span>
                    </p>
                </div>
                <div class="space-y-6">
                    <div class="flex items-start gap-4">
                        <div class="bg-[#E31C25] text-white w-10 h-10 flex items-center justify-center flex-shrink-0 border-2 border-black">
                            <i class="ph-bold ph-funnel text-lg"></i>
                        </div>
                        <div>
                            <h4 class="font-black uppercase text-sm mb-1">Curated for Relevance</h4>
                            <p class="slab-text text-gray-600 text-sm">We skip the fluff. Only insights that pass the practitioner filter.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-4">
                        <div class="bg-[#006AB4] text-white w-10 h-10 flex items-center justify-center flex-shrink-0 border-2 border-black">
                            <i class="ph-bold ph-crosshair text-lg"></i>
                        </div>
                        <div>
                            <h4 class="font-black uppercase text-sm mb-1">Filtered Through Real GTM Experience</h4>
                            <p class="slab-text text-gray-600 text-sm">Every takeaway is validated against real-world go-to-market execution.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-4">
                        <div class="bg-[#FFC906] text-black w-10 h-10 flex items-center justify-center flex-shrink-0 border-2 border-black">
                            <i class="ph-bold ph-link text-lg"></i>
                        </div>
                        <div>
                            <h4 class="font-black uppercase text-sm mb-1">Linked to Original Source</h4>
                            <p class="slab-text text-gray-600 text-sm">Go deeper anytime. Every insight traces back to the original material.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ===== SUBSCRIBE CTA ===== -->
    <section id="subscribe" class="py-16 px-4 max-w-7xl mx-auto">
        <div class="bg-[#1a1a1a] border-4 border-black p-8 md:p-14 text-center relative overflow-hidden">
            <div class="absolute top-4 left-4 w-16 h-16 border-4 border-[#FFC906] opacity-20 rotate-12"></div>
            <div class="absolute bottom-4 right-4 w-24 h-24 border-4 border-[#E31C25] opacity-20 -rotate-12"></div>

            <div class="relative z-10">
                <h2 class="text-4xl md:text-5xl brand-font text-white uppercase mb-4">
                    Get the Best Thinking, <span class="text-[#FFC906]">Weekly</span>
                </h2>
                <p class="slab-text text-gray-400 text-lg mb-8 max-w-xl mx-auto">
                    Short, sharp insights from podcasts, books, and videos. Delivered every week. No spam. Ever.
                </p>
                <div class="flex flex-col sm:flex-row gap-3 max-w-lg mx-auto">
                    <input type="email" placeholder="your@email.com" class="flex-1 bg-white border-4 border-black px-5 py-3 font-bold text-lg placeholder:text-gray-400 focus:outline-none">
                    <button class="bg-[#FFC906] text-black border-4 border-black font-black py-3 px-8 uppercase text-sm tracking-widest hover:bg-[#E31C25] hover:text-white transition-colors whitespace-nowrap">
                        Subscribe to ACME
                    </button>
                </div>
                <p class="text-gray-600 text-xs font-bold uppercase tracking-wider mt-4">Join 2,400+ marketers who read ACME weekly</p>
            </div>
        </div>
    </section>

</BaseLayout>
